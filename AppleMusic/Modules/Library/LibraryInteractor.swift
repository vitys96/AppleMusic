//
//  LibraryInteractor.swift
//  AppleMusic
//
//  Created Vitaly on 24.11.2019.
//  Copyright Â© 2019 Vitaly. All rights reserved.
//
//  Template generated by Sakhabaev Egor @Banck
//  https://github.com/Banck/Swift-viper-template-for-xcode
//

import UIKit
import RealmSwift

class LibraryInteractor: LibraryInteractorInput {
    
    
    private let realm = try! Realm()
    
    // MARK: - Properties
    weak var presenter: LibraryInteractorOutput?
    
    // MARK: - LibraryInteractorInput -
    func fetchTracksFromDB() {
        let results = DBManager.sharedInstance.getDataFromTrackList()
        let songsDB: [SearchCell.ViewModel] = results.map {
            let image = UIImage(data: $0.trackImageView ?? Data())
            return SearchCell.ViewModel(id: $0.trackID, trackName: $0.trackName, artistName: $0.artistName, collectionName: $0.collectionName, songIconUrl: $0.songIconUrl100, songMp4: $0.songm4p, trackImage: image)
        }
        self.presenter?.fetchedTracksFromDB(songs: songsDB)
    }
    
    func deleteTrackFromDB(id: Int) {
        if let trackToDelete = realm.objects(TrackModel.self).filter("trackID = \(id)").first {
           DBManager.sharedInstance.deleteTrackFromDb(object: trackToDelete)
        }
    }
}
